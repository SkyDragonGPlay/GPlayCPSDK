#Gplay CP对接服务端说明
#登录信息验证
cp在客户端获取到了Gplay颁发的用户信息及token之后，可以自行实现自己的客户端与服务端的交互，完成自己的业务流程，为了防止出现数据被劫持篡改的情况，建议（非必须）cp通过自己的服务端与Gplay的服务端进行一次登录数据校验，校验接口如下
##  登录验证接口
-	登录验证接口：http://api.skydragon-inc.cn/user/appLoginOauth
-   访问方式：POST
-   访问参数
    -   gtoken Gplay颁发的令牌，有效期3600秒，使用后即失效
    -   guid Gplay生成的全局唯一的用户ID
- 返回
	
		 {
		    "result": {
		        "status": "ok",
		        "error": "",
		        "error_no": ""
		    },
		    "data": {
		        "user_data": {
		            "guid": "d972d2132e5faf051db7a1ec00ce9b5f"
		        },
		        "ext": {
                    "channel_code":666666
		        }
		    }
		}
        user_data 统一用户数据
            guid Gplay用户系统唯一标识
        ext 需要传给CP的扩展字段，各渠道不同
-	登录验证接口使用demo：见附件



	cp在对接Gplay的服务端时，需要在自己的服务器上实现以下接口，并将相关的接口地址配置到Gplay管理后台中
## 订单支付通知地址
订单支付完成后, Gplay SDK支付通知服务会把支付结果（POST方式）通知给开发者配置的支付通知地址（回调地址）；cp服务器接收验证参数后, 给用户充值或发放道具；

-	编码说明：传输过程一律使用UTF-8 without bom编码
-	参数说明
	-	order_sn Gplay订单号
	-	pay_status 支付状态 0 等待支付 1支付成功 2支付失败
	-	product_amount 支付金额 RMB 分为单位
	-	product_price 商品单价
	-	product_count 商品数目
	-	product_name 商品名
	-	product_id 商品ID（游戏内部商品标识）
	-	user_id 渠道用户唯一标识
	-	game\_user\_id 游戏内部用户唯一标识
	-	server_id 游戏服务器标识
	-	channel_code 渠道编号
	-	channel\_order\_id 渠道订单编号（如果渠道数据有返回此项才有，否则此项为空）
	-	private\_data 自定义参数，调用客户端支付函数时传入的private_\data参数，透传给游戏服务器
	-	source 渠道服务器通知 GplaySDK Server 时请求的参数
	-	pay_time 支付时间
	-	sign 签名
	-	注：以上参数不会减少，但有可能新增，开发者在接收支付通知时，不能写死判断参数个数，签名时请使用数组或对象或Map自动排序及连接字符串，如php的ksort及implode方法；

-	接收支付通知步骤
	-	接收Gplay SDK支付通知参数
	-	验证Gplay SDK签名及检查支付金额
	-	成功响应及发放道具（失败响应及日志记录）
	
-	cp服务器响应
	-	应用在接收到通知消息后, 需回应 ok 或 OK (不带任何空白字符、隐藏字符、控制字符的2个字节长度的纯字符串), 表示通知已经接收. 如果回应其他值或者不回应, 则被认为通知失败, Gplay SDK支付通知服务器会尝试多次通知.
	-	注意：cp服务器对Gplay SDK推送过来的信息做校验，只要cp服务器完成本次通知处理，校验结果为数据正常，校验通过，请务必返回正确的响应 ok或OK(不带任何空白字符、隐藏字符、控制字符的2个字节长度的纯字符串)，否则Gplay SDK会重复通知，给cp服务器带来压力


-	签名算法
	-	准备应用private\_key
	-	将除了sign之外的参数所有参数按参数名升序排列之后的值顺序拼接，得到str1,参数名本身不参与拼接
	-	对str1进行md5计算并转换为小写 得到md51
	-	将md51和应用private\_key连接在一起 得到str2 str2=md51+private\_key
	-	对str2进行md5计算并转换为小写 得到最终sign

-	重复通知
	-	开发商服务器应做好接收到多次通知的准备, 防止多次加钱。
	-	同时, 需要特别注意的是, 回应ok或OK(不带任何空白字符、隐藏字符、控制字符的2个字节长度的纯字符串)表示应用已经正常接到消息, 无需继续发送通知， 它不表示订单成功与否, 或者处理成功与否。
	-	对于重复的通知, 可能发现订单已经成功处理完毕, 无需继续处理, 也要返回ok或OK(不带任何空白字符、隐藏字符、控制字符的2个字节长度的纯字符串). 否则, Gplay SDK支付通知服务会认为未成功通知, 会继续发送通知。
	-	重复通知间隔为： 2分钟,10分钟 ,10分钟 ,1 小时 ,2 小时 ,6 小时 ,15小时共 7次，直到中间有收到接收成功的反馈消息，或７次发送完，结束周期性发送。
-	支付通知地址demo：见附件


